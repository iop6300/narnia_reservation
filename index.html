<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10월 18일 행사 예약</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
        }
        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 480px;
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        p {
            color: #666;
            margin-bottom: 24px;
        }
        .form-group {
            margin-bottom: 16px;
            text-align: left;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            background: #fff;
        }
        textarea { resize: vertical; min-height: 84px; }
        button {
            width: 100%;
            padding: 14px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #0056b3; }
        #message {
            margin-top: 16px;
            font-weight: 700;
        }
        .fine-print {
            margin-top: 10px;
            font-size: 12px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>행사 예약</h1>
        <p>2025년 10월 18일</p>
        <form id="reservationForm" novalidate>
            <div class="form-group">
                <label for="student_name">학생이름</label>
                <input type="text" id="student_name" name="student_name" required placeholder="예) 김나니">
            </div>
            <div class="form-group">
                <label for="parent_phone">보호자 연락처</label>
                <input type="tel" id="parent_phone" name="parent_phone" required placeholder="예) 010-1234-5678">
            </div>
            <div class="form-group">
                <label for="slot">예약 시간</label>
                <select id="slot" name="slot" required>
                    <option value="">시간 선택</option>
                    <option>10:30</option>
                    <option>11:00</option>
                    <option>11:30</option>
                    <option>12:00</option>
                    <option>12:30</option>
                    <option>13:00</option>
                    <option>13:30</option>
                    <option>14:00</option>
                    <option>14:30</option>
                    <option>15:00</option>
                    <option>15:30</option>
                    <option>16:00</option>
                    <option>16:30</option>
                </select>
            </div>
            <div class="form-group">
                <label for="school_level">학교급</label>
                <select id="school_level" name="school_level" required>
                    <option value="">선택</option>
                    <option>초등학교</option>
                    <option>중학교</option>
                    <option>고등학교</option>
                </select>
            </div>
            <div class="form-group">
                <label for="grade">학생 학년</label>
                <input type="text" id="grade" name="grade" required placeholder="예) 2학년">
            </div>
            <div class="form-group">
                <label for="interest">학생 관심분야</label>
                <input type="text" id="interest" name="interest" placeholder="예) AI, 게임, 로봇 등">
            </div>
            <button id="reserveBtn" type="submit">예약하기</button>
        </form>
        <div id="message" aria-live="polite"></div>
        <div class="fine-print">※ 동일 시간 중복 예약은 자동으로 거절됩니다.</div>
    </div>

    <script>
        // 제공받은 Apps Script Web App URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyBhdDBkbn55XF52nqRu1YPbHKsxCwE6byESt7WO_mcFjdOzIxvRFH0PVKHbSNjzBPW_w/exec';
        // 고정 행사 날짜
        const FIXED_DATE = '2025-10-18';

        const form = document.getElementById('reservationForm');
        const msg = document.getElementById('message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // 간단 검증
            if (!form.checkValidity()) {
                msg.textContent = '필수 항목을 모두 입력해주세요.';
                msg.style.color = 'red';
                return;
            }

            msg.textContent = '예약 정보를 전송 중입니다...';
            msg.style.color = '#333';

            const payload = {
                student_name: document.getElementById('student_name').value.trim(),
                parent_phone: document.getElementById('parent_phone').value.trim(),
                date: FIXED_DATE,
                slot: document.getElementById('slot').value,
                school_level: document.getElementById('school_level').value,
                grade: document.getElementById('grade').value.trim(),
                interest: document.getElementById('interest').value.trim(),
                userAgent: navigator.userAgent
            };

            try {
                const res = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' }, // preflight 회피
                    body: JSON.stringify(payload)
                });
                const json = await res.json();
                if (json.ok) {
                    msg.textContent = '✅ 예약이 완료되었습니다!';
                    msg.style.color = 'green';
                    form.reset();
                } else if (json.error === 'DUPLICATE_SLOT') {
                    msg.textContent = '❌ 이미 예약된 시간대입니다. 다른 시간대를 선택해주세요.';
                    msg.style.color = 'red';
                } else if (json.error === 'MISSING_FIELDS') {
                    msg.textContent = '❌ 필수 항목(이름/날짜/시간대)을 입력해주세요.';
                    msg.style.color = 'red';
                } else {
                    msg.textContent = '❌ 예약 처리 중 오류가 발생했습니다: ' + (json.error || '알 수 없는 오류');
                    msg.style.color = 'red';
                }
            } catch (err) {
                msg.textContent = '❌ 네트워크 오류: ' + String(err);
                msg.style.color = 'red';
            }
        });
    </script>
</body>
</html>
