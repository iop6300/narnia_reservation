<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10월 18일 행사 예약</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; margin: 0; background-color: #f4f7f6;
    }
    .container {
      background-color: #ffffff; padding: 40px; border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 480px; text-align: center;
    }
    h1 { color: #333; margin-bottom: 10px; }
    p { color: #666; margin-bottom: 24px; }
    .form-group { margin-bottom: 16px; text-align: left; }
    label { display: block; margin-bottom: 8px; color: #555; font-weight: 600; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
    button { width: 100%; padding: 14px; background-color: #007bff; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 700; cursor: pointer; transition: background-color .3s; }
    button:hover { background-color: #0056b3; }
    #message { margin-top: 16px; font-weight: 700; color: #0a8f3c; display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>행사 예약</h1>
    <p>2025년 10월 18일</p>

    <form
      action="https://docs.google.com/forms/d/e/1FAIpQLScSgLalQZ7wq4n2w8gAn04Rs4OHnRbs-nMGGV8-fyVGj2_vdA/formResponse"
      method="POST"
      target="hidden_iframe"
      onsubmit="window._submitted=true"
    >
      <div class="form-group">
        <label for="student_name">학생이름</label>
        <input type="text" id="student_name" name="entry.809640200" required placeholder="예) 김나니" />
      </div>

      <div class="form-group">
        <label for="parent_phone">보호자 연락처</label>
        <input type="tel" id="parent_phone" name="entry.543683465" required placeholder="예) 010-1234-5678" />
      </div>

      <div class="form-group">
        <label for="slot">예약 시간</label>
        <select id="slot" name="entry.1621677829" required>
          <option value="">시간 선택</option>
          <option>10:30</option>
          <option>11:00</option>
          <option>11:30</option>
          <option>12:00</option>
          <option>12:30</option>
          <option>13:00</option>
          <option>13:30</option>
          <option>14:00</option>
          <option>14:30</option>
          <option>15:00</option>
          <option>15:30</option>
          <option>16:00</option>
          <option>16:30</option>
        </select>
      </div>

      <div class="form-group">
        <label for="school_level">학교급</label>
        <select id="school_level" name="entry.261454937" required>
          <option value="">선택</option>
          <option>초등학교</option>
          <option>중학교</option>
          <option>고등학교</option>
        </select>
      </div>

      <div class="form-group">
        <label for="grade">학생 학년</label>
        <input type="text" id="grade" name="entry.156928591" required placeholder="예) 2학년" />
      </div>

      <div class="form-group">
        <label for="interest">학생 관심분야</label>
        <input type="text" id="interest" name="entry.763983283" placeholder="예) AI, 게임, 로봇 등" />
      </div>

      <button type="submit">예약하기</button>
    </form>

    <div id="message" aria-live="polite">✅ 예약이 완료되었습니다! 담당자가 확인 후 연락드립니다.</div>
  </div>

  <iframe name="hidden_iframe" style="display:none;" onload="if(window._submitted){document.getElementById('message').style.display='block';}"></iframe>

  <script>
  // CSV를 불러와 인원수 >=10인 시간대는 비활성화
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-3NyxcSuT4ae-vKID-puCXh81IXh53lhbiYfifAe3mphkeOJ6XlZ6GF1sLr2K6oXfC0suC4HujR2m/pub?gid=1837035928&single=true&output=csv"; // 업로드된 CSV의 공개 URL
  const MAX_PEOPLE = 10;

  async function updateSlots() {
    try {
      const res = await fetch(CSV_URL + "?t=" + Date.now());
      const text = await res.text();
      const lines = text.trim().split(/\r?\n/);
      const data = lines.slice(1).map(line => line.split(','));
      const map = new Map();
      for (const [time, count] of data) {
        map.set(time.trim(), parseInt(count.trim()));
      }

      const select = document.getElementById("slot");
      for (const opt of select.options) {
        if (!opt.value) continue;
        const count = map.get(opt.value.trim()) || 0;
        if (count >= MAX_PEOPLE) {
          opt.disabled = true;
          opt.textContent = `${opt.value} (마감)`;
        } else {
          opt.disabled = false;
          opt.textContent = opt.value;
        }
      }
    } catch (err) {
      console.error("CSV 불러오기 실패:", err);
    }
  }

  updateSlots();
  setInterval(updateSlots, 60000); // 1분마다 갱신
  </script>
</body>
</html>
